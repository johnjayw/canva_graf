<!doctype html>
<html lang="sk" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Animovaný linkový graf</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'Space Grotesk', sans-serif;
    }
    .animated-number {
      transition: font-size 0.2s;
      font-size: 2rem;
    }
    .svg-animated-year {
      font-size: 2.5rem;
      font-weight: bold;
      fill: #fbbf24;
      text-shadow: 2px 2px 8px #000, 0 0 4px #fff;
      paint-order: stroke fill;
      stroke: #000;
      stroke-width: 2px;
      filter: drop-shadow(0 2px 8px #0008);
      dominant-baseline: middle;
    }
  </style>
</head>
<body class="h-full bg-slate-900 text-white overflow-auto">
  <div class="h-full w-full p-3">
    <div class="w-full max-w-5xl mx-auto">
      <h1 id="chart-title" class="text-lg font-bold text-center mb-2 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
        Porovnanie ročného výnosu a výkonnosti
      </h1>
      <!-- Animation controls -->
      <div class="flex flex-col items-center gap-2 mb-2">
        <div class="flex justify-center gap-2 flex-wrap">
          <button id="toggle-btn" class="px-2 py-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 rounded text-xs font-semibold transition-all duration-200 flex items-center gap-1 shadow-lg hover:shadow-indigo-500/50">
            <span id="toggle-btn-icon">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" /></svg>
            </span>
            <span id="toggle-btn-text">Prehrať</span>
          </button>
          <button id="restart-btn" class="px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded text-xs font-semibold transition-all duration-200 flex items-center gap-1 shadow-lg">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" /></svg>
            Reštartovať
          </button>
        </div>
        <!-- Speed control -->
        <div class="flex items-center gap-2 bg-slate-800/50 rounded-lg px-3 py-1.5 border border-slate-700/50">
          <label for="speed-slider" class="text-slate-400 text-xs font-semibold flex items-center gap-1">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
            Rýchlosť:
          </label>
          <input type="range" id="speed-slider" min="0.1" max="5" step="0.1" value="0.1" class="w-24 h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500">
          <span id="speed-value" class="text-indigo-400 font-bold text-xs min-w-[2rem] text-center">0.1x</span>
        </div>
        <!-- Font size control -->
        <div class="flex items-center gap-2 bg-slate-800/50 rounded-lg px-3 py-1.5 border border-slate-700/50">
          <label for="font-size-slider" class="text-slate-400 text-xs font-semibold flex items-center gap-1">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><text x="2" y="15" font-size="14" fill="currentColor">A</text></svg>
            Veľkosť čísiel:
          </label>
          <input type="range" id="font-size-slider" min="1" max="4" step="0.1" value="2" class="w-24 h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500">
          <span id="font-size-value" class="text-indigo-400 font-bold text-xs min-w-[2rem] text-center">2.0x</span>
        </div>
      </div>
      <div class="bg-slate-800/50 rounded-xl p-2 backdrop-blur-sm border border-slate-700/50">
        <div id="chart-container" class="w-full"></div>
        <!-- Legend -->
        <div class="flex justify-center gap-3 mt-2">
          <div class="flex items-center gap-1">
            <div class="w-2.5 h-2.5 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500"></div>
            <span class="text-slate-400 text-xs">Ročný výnos</span>
          </div>
          <div class="flex items-center gap-1">
            <div class="w-2.5 h-2.5 rounded-full bg-gradient-to-r from-emerald-500 to-green-400"></div>
            <span class="text-slate-400 text-xs">Výkonnosť</span>
          </div>
        </div>
      </div>
      <!-- Stats cards -->
      <div class="grid grid-cols-3 gap-2 mt-2">
        <div class="bg-slate-800/50 rounded-lg p-2 border border-slate-700/50">
          <p class="text-slate-400 text-xs">Ročný výnos</p>
          <p id="stat-rocny" class="animated-number font-bold text-indigo-400">0.00%</p>
          <p class="text-slate-500 text-xs">rok <span id="total-years">2073</span></p>
        </div>
        <div class="bg-slate-800/50 rounded-lg p-2 border border-slate-700/50">
          <p class="text-slate-400 text-xs">Výkonnosť</p>
          <p id="stat-vykonnost" class="animated-number font-bold text-emerald-400">0.00%</p>
          <p class="text-slate-500 text-xs">rok <span id="total-years">2073</span></p>
        </div>
        <div class="bg-slate-800/50 rounded-lg p-2 border border-slate-700/50">
          <p class="text-slate-400 text-xs">Rozdiel</p>
          <p id="stat-rozdiel" class="animated-number font-bold text-pink-400">+0.00%</p>
          <p class="text-emerald-400 text-xs">↑ Prevýšenie</p>
        </div>
      </div>
    </div>
  </div>
  <script>
    const rawData = [
      { datum: '2023', rocny_vynos: 2.93, vykonnost: 2.88 },
      { datum: '2024', rocny_vynos: 9.93, vykonnost: 10.08 },
      { datum: '2025', rocny_vynos: 16.93, vykonnost: 17.78 },
      { datum: '2026', rocny_vynos: 23.93, vykonnost: 26.03 },
      { datum: '2027', rocny_vynos: 30.93, vykonnost: 34.85 },
      { datum: '2028', rocny_vynos: 37.93, vykonnost: 44.29 },
      { datum: '2029', rocny_vynos: 44.93, vykonnost: 54.39 },
      { datum: '2030', rocny_vynos: 51.93, vykonnost: 65.2 },
      { datum: '2031', rocny_vynos: 58.93, vykonnost: 76.76 },
      { datum: '2032', rocny_vynos: 65.93, vykonnost: 89.14 },
      { datum: '2033', rocny_vynos: 72.93, vykonnost: 102.37 },
      { datum: '2034', rocny_vynos: 79.93, vykonnost: 116.54 },
      { datum: '2035', rocny_vynos: 86.93, vykonnost: 131.7 },
      { datum: '2036', rocny_vynos: 93.93, vykonnost: 147.92 },
      { datum: '2037', rocny_vynos: 100.93, vykonnost: 165.27 },
      { datum: '2038', rocny_vynos: 107.93, vykonnost: 183.84 },
      { datum: '2039', rocny_vynos: 114.93, vykonnost: 203.71 },
      { datum: '2040', rocny_vynos: 121.93, vykonnost: 224.97 },
      { datum: '2041', rocny_vynos: 128.93, vykonnost: 247.72 },
      { datum: '2042', rocny_vynos: 135.93, vykonnost: 272.06 },
      { datum: '2043', rocny_vynos: 142.93, vykonnost: 298.1 },
      { datum: '2044', rocny_vynos: 149.93, vykonnost: 325.97 },
      { datum: '2045', rocny_vynos: 156.93, vykonnost: 355.79 },
      { datum: '2046', rocny_vynos: 163.93, vykonnost: 387.69 },
      { datum: '2047', rocny_vynos: 170.93, vykonnost: 421.83 },
      { datum: '2048', rocny_vynos: 177.93, vykonnost: 458.36 },
      { datum: '2049', rocny_vynos: 184.93, vykonnost: 497.44 },
      { datum: '2050', rocny_vynos: 191.93, vykonnost: 539.26 },
      { datum: '2051', rocny_vynos: 198.93, vykonnost: 584.01 },
      { datum: '2052', rocny_vynos: 205.93, vykonnost: 631.89 },
      { datum: '2053', rocny_vynos: 212.93, vykonnost: 683.12 },
      { datum: '2054', rocny_vynos: 219.93, vykonnost: 737.94 },
      { datum: '2055', rocny_vynos: 226.93, vykonnost: 796.6 },
      { datum: '2056', rocny_vynos: 233.93, vykonnost: 859.36 },
      { datum: '2057', rocny_vynos: 240.93, vykonnost: 926.52 },
      { datum: '2058', rocny_vynos: 247.93, vykonnost: 998.37 },
      { datum: '2059', rocny_vynos: 254.93, vykonnost: 1075.26 },
      { datum: '2060', rocny_vynos: 261.93, vykonnost: 1157.53 },
      { datum: '2061', rocny_vynos: 268.93, vykonnost: 1245.55 },
      { datum: '2062', rocny_vynos: 275.93, vykonnost: 1339.74 },
      { datum: '2063', rocny_vynos: 282.93, vykonnost: 1440.52 },
      { datum: '2064', rocny_vynos: 289.93, vykonnost: 1548.36 },
      { datum: '2065', rocny_vynos: 296.93, vykonnost: 1663.74 },
      { datum: '2066', rocny_vynos: 303.93, vykonnost: 1787.21 },
      { datum: '2067', rocny_vynos: 310.93, vykonnost: 1919.31 },
      { datum: '2068', rocny_vynos: 317.93, vykonnost: 2060.67 },
      { datum: '2069', rocny_vynos: 324.93, vykonnost: 2211.91 },
      { datum: '2070', rocny_vynos: 331.93, vykonnost: 2373.74 },
      { datum: '2071', rocny_vynos: 338.93, vykonnost: 2546.9 },
      { datum: '2072', rocny_vynos: 345.93, vykonnost: 2732.2 },
      { datum: '2073', rocny_vynos: 350, vykonnost: 2845.7 }
    ];

    let animationSpeed = 0.1;
    let isPaused = true;
    let fontSizeMultiplier = 2;
    let animationFrame = null;
    let animationState = {
      startTime: null,
      elapsed: 0,
      duration: 2000,
      progress: 0,
      running: false
    };

    function setAnimatedNumbersFontSize(multiplier) {
      document.querySelectorAll('.animated-number').forEach(el => {
        el.style.fontSize = (multiplier * 1) + 'rem';
      });
    }

    function renderChart(progress = 0) {
      const chartContainer = document.getElementById('chart-container');
      if (!chartContainer) return;

      const displayData = rawData.filter((_, i) => i % 5 === 0 || i === rawData.length - 1);
      const maxValue = Math.max(...rawData.map(d => Math.max(d.rocny_vynos, d.vykonnost)));
      const minValue = 0;
      const valueRange = maxValue - minValue;
      const width = 900;
      const height = 400;
      const padding = { left: 70, right: 40, top: 40, bottom: 60 };
      const chartWidth = width - padding.left - padding.right;
      const chartHeight = height - padding.top - padding.bottom;

      // Koľko bodov zobraziť podľa progressu
      const totalPoints = rawData.length;
      const pointsToShow = Math.max(1, Math.floor(progress * (totalPoints - 1)) + 1);

      // Vygeneruj body pre aktuálny progress
      function getPartialPath(data, valueKey) {
        let path = '';
        for (let i = 0; i < pointsToShow; i++) {
          const d = data[i];
          const x = padding.left + (i / (totalPoints - 1)) * chartWidth;
          const y = padding.top + chartHeight - ((d[valueKey] - minValue) / valueRange) * chartHeight;
          path += (i === 0 ? `M${x},${y}` : `L${x},${y}`);
        }
        // Ak animácia je medzi bodmi, dopočítaj interpolovaný bod
        if (pointsToShow < totalPoints) {
          const i = pointsToShow - 1;
          const next = rawData[pointsToShow];
          const prev = rawData[i];
          const localProgress = (progress * (totalPoints - 1)) % 1;
          const interp = prev[valueKey] + (next[valueKey] - prev[valueKey]) * localProgress;
          const x = padding.left + ((i + localProgress) / (totalPoints - 1)) * chartWidth;
          const y = padding.top + chartHeight - ((interp - minValue) / valueRange) * chartHeight;
          path += `L${x},${y}`;
        }
        return path;
      }

      const rocnyVynosPath = getPartialPath(rawData, 'rocny_vynos');
      const vykonnostPath = getPartialPath(rawData, 'vykonnost');

      // Area fill path pre ročný výnos
      let areaPath = rocnyVynosPath;
      // Pridaj spodok plochy
      if (pointsToShow < totalPoints) {
        const i = pointsToShow - 1;
        const next = rawData[pointsToShow];
        const prev = rawData[i];
        const localProgress = (progress * (totalPoints - 1)) % 1;
        const interp = prev.rocny_vynos + (next.rocny_vynos - prev.rocny_vynos) * localProgress;
        const x = padding.left + ((i + localProgress) / (totalPoints - 1)) * chartWidth;
        areaPath += `L${x},${padding.top + chartHeight}`;
        areaPath += `L${padding.left},${padding.top + chartHeight}Z`;
      } else {
        areaPath += `L${padding.left + chartWidth},${padding.top + chartHeight}L${padding.left},${padding.top + chartHeight}Z`;
      }

      const yLabels = [];
      for (let i = 0; i <= 5; i++) {
        const value = minValue + (valueRange / 5) * (5 - i);
        const y = padding.top + (chartHeight / 5) * i;
        yLabels.push({ value: value.toFixed(0), y });
      }

      const xLabels = displayData.map((d) => {
        const dataIndex = rawData.indexOf(d);
        const x = padding.left + (dataIndex / (rawData.length - 1)) * chartWidth;
        return { label: d.datum, x };
      });

      // SVG animated year label
      const startYear = parseInt(rawData[0].datum, 10);
      const endYear = parseInt(rawData[rawData.length - 1].datum, 10);

      let svg = `
        <svg viewBox="0 0 ${width} ${height}" class="w-full h-auto">
          <defs>
            <linearGradient id="lineGradient1" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#6366f1"/>
              <stop offset="100%" style="stop-color:#8b5cf6"/>
            </linearGradient>
            <linearGradient id="lineGradient2" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#10b981"/>
              <stop offset="100%" style="stop-color:#34d399"/>
            </linearGradient>
            <linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#8b5cf6"/>
              <stop offset="100%" style="stop-color:transparent"/>
            </linearGradient>
          </defs>
          <g class="grid-lines">`;

      yLabels.forEach((label) => {
        svg += `<line x1="${padding.left}" y1="${label.y}" x2="${padding.left + chartWidth}" y2="${label.y}" stroke="#475569" stroke-width="1" opacity="0.3"/>`;
      });

      svg += `</g>
          <g class="y-labels" fill="#94a3b8" font-size="12">`;

      yLabels.forEach((label) => {
        svg += `<text x="${padding.left - 10}" y="${label.y + 4}" text-anchor="end">${label.value}%</text>`;
      });

      svg += `</g>
          <g class="x-labels" fill="#94a3b8" font-size="11">`;

      xLabels.forEach((label) => {
        svg += `<text x="${label.x}" y="${padding.top + chartHeight + 25}" text-anchor="middle">${label.label}</text>`;
      });

      svg += `</g>
          <path d="${areaPath}" fill="url(#areaGradient)" opacity="0.15"/>
          <path d="${rocnyVynosPath}" fill="none" stroke="url(#lineGradient1)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="${vykonnostPath}" fill="none" stroke="url(#lineGradient2)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          <text id="svg-animated-year" class="svg-animated-year" x="${width - 120}" y="${padding.top + 40}" text-anchor="end">0 rokov</text>
        </svg>`;

      chartContainer.innerHTML = svg;

      document.querySelectorAll('#total-years').forEach(el => el.textContent = rawData[rawData.length - 1].datum);

      setAnimatedNumbersFontSize(fontSizeMultiplier);
    }

    function animateAll() {
      const duration = 2000 / animationSpeed;
      const startYear = parseInt(rawData[0].datum, 10);
      const endYear = parseInt(rawData[rawData.length - 1].datum, 10);
      const totalYears = endYear - startYear;
      const finalRocnyVynos = rawData[rawData.length - 1].rocny_vynos;
      const finalVykonnost = rawData[rawData.length - 1].vykonnost;
      const difference = finalVykonnost - finalRocnyVynos;

      const statRocny = document.getElementById('stat-rocny');
      const statVykonnost = document.getElementById('stat-vykonnost');
      const statRozdiel = document.getElementById('stat-rozdiel');

      function update(now) {
        if (!animationState.startTime) animationState.startTime = now - animationState.elapsed;
        if (!animationState.running) {
          animationState.startTime = now - animationState.elapsed;
        }
        animationState.running = true;
        animationState.elapsed = now - animationState.startTime;
        let progress = Math.min(animationState.elapsed / duration, 1);
        animationState.progress = progress;

        // Synchronizované hodnoty
        statRocny.textContent = (finalRocnyVynos * progress).toFixed(2) + '%';
        statVykonnost.textContent = (finalVykonnost * progress).toFixed(2) + '%';
        statRozdiel.textContent = '+' + (difference * progress).toFixed(2) + '%';

        // SVG graf a roky
        renderChart(progress);
        const svgYear = document.getElementById('svg-animated-year');
        if (svgYear) svgYear.textContent = Math.round(totalYears * progress) + ' rokov';

        if (progress < 1 && !isPaused) {
          animationFrame = requestAnimationFrame(update);
        } else {
          animationState.running = false;
        }
      }
      animationFrame = requestAnimationFrame(update);
    }

    function pauseAnimation() {
      isPaused = true;
      animationState.running = false;
      cancelAnimationFrame(animationFrame);
      updateToggleBtn();
    }

    function resumeAnimation() {
      isPaused = false;
      if (animationState.progress >= 1) return;
      animationFrame = requestAnimationFrame(animateAll);
      updateToggleBtn();
    }

    function restartAnimation() {
      isPaused = true;
      animationState.startTime = null;
      animationState.elapsed = 0;
      animationState.progress = 0;
      animationState.running = false;
      cancelAnimationFrame(animationFrame);
      renderChart(0);
      updateToggleBtn();
    }

    function updateToggleBtn() {
      const toggleBtnIcon = document.getElementById('toggle-btn-icon');
      const toggleBtnText = document.getElementById('toggle-btn-text');
      if (isPaused) {
        toggleBtnIcon.innerHTML = `<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" /></svg>`;
        toggleBtnText.textContent = "Prehrať";
      } else {
        toggleBtnIcon.innerHTML = `<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M5.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75A.75.75 0 007.25 3h-1.5zM12.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75a.75.75 0 00-.75-.75h-1.5z" /></svg>`;
        toggleBtnText.textContent = "Pozastaviť";
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderChart(0);
      restartAnimation();

      const toggleBtn = document.getElementById('toggle-btn');
      const restartBtn = document.getElementById('restart-btn');
      const speedSlider = document.getElementById('speed-slider');
      const speedValue = document.getElementById('speed-value');
      const fontSizeSlider = document.getElementById('font-size-slider');
      const fontSizeValue = document.getElementById('font-size-value');

      toggleBtn.addEventListener('click', () => {
        if (isPaused) {
          isPaused = false;
          resumeAnimation();
        } else {
          pauseAnimation();
        }
      });

      restartBtn.addEventListener('click', () => {
        restartAnimation();
      });

      speedSlider.addEventListener('input', (e) => {
        animationSpeed = parseFloat(e.target.value);
        speedValue.textContent = `${animationSpeed.toFixed(1)}x`;
        restartAnimation();
      });

      fontSizeSlider.addEventListener('input', (e) => {
        fontSizeMultiplier = parseFloat(e.target.value);
        fontSizeValue.textContent = `${fontSizeMultiplier.toFixed(1)}x`;
        setAnimatedNumbersFontSize(fontSizeMultiplier);
      });

      setAnimatedNumbersFontSize(fontSizeMultiplier);
      updateToggleBtn();
    });
  </script>
</body>
</html>